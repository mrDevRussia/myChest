#!/usr/bin/env python3
"""
Test Malware Creator for ArcSentinel

This script creates harmless test files that match the signatures in ArcSentinel.
These files are NOT actual malware but are designed to trigger detection
for testing purposes only.
"""

import os
import hashlib
import argparse

# Test signatures from ArcSentinel
TEST_SIGNATURES = {
    "test_malware_1": "e1a1d38bc042e13e8d2dcb7184641c5abe21e5836715a5c6cc4cd1be9ab781b8",
    "test_malware_2": "b1a8d38bc042e13e8d2dcb7184641c5abe21e5836715a5c6cc4cd1be9ab781c9",
    "test_ransomware": "c1a7d38bc042e13e8d2dcb7184641c5abe21e5836715a5c6cc4cd1be9ab781d0"
}

def create_test_file(malware_type, output_dir):
    """Create a test file that matches a specific signature"""
    if malware_type not in TEST_SIGNATURES:
        print(f"Unknown test malware type: {malware_type}")
        print(f"Available types: {', '.join(TEST_SIGNATURES.keys())}")
        return False
    
    target_hash = TEST_SIGNATURES[malware_type]
    
    # Create output directory if it doesn't exist
    if not os.path.exists(output_dir):
        os.makedirs(output_dir)
    
    output_file = os.path.join(output_dir, f"{malware_type}_test.txt")
    
    # Start with a base content
    content = f"""This is a test file for ArcSentinel antivirus.
    
This file is designed to match the signature for {malware_type}.
It is NOT actual malware and is completely harmless.

Target SHA-256: {target_hash}

"""
    
    # Append data until we match the target hash
    counter = 0
    while True:
        test_content = content + f"Padding data: {counter}\n"
        file_hash = hashlib.sha256(test_content.encode()).hexdigest()
        
        if file_hash == target_hash:
            # We found the right content that produces our target hash
            with open(output_file, 'w') as f:
                f.write(test_content)
            print(f"Created test file: {output_file}")
            print(f"SHA-256: {file_hash}")
            return True
        
        counter += 1
        if counter % 10000 == 0:
            print(f"Still searching... (attempts: {counter})")
        
        # Safety limit
        if counter > 1000000:
            print("Couldn't find matching content after 1,000,000 attempts.")
            print("Creating file with predefined content instead.")
            
            # Instead, create a file with the exact hash string
            with open(output_file, 'w') as f:
                f.write(f"TEST MALWARE SIGNATURE: {target_hash}\n")
                f.write(content)
            
            print(f"Created test file with signature string: {output_file}")
            return True

def main():
    parser = argparse.ArgumentParser(description="Create test files for ArcSentinel antivirus detection")
    parser.add_argument(
        "type", 
        choices=list(TEST_SIGNATURES.keys()) + ["all"],
        help="Type of test file to create"
    )
    parser.add_argument(
        "--output", "-o",
        default="test_files",
        help="Output directory for test files (default: ./test_files)"
    )
    
    args = parser.parse_args()
    
    print("=== ArcSentinel Test File Creator ===")
    print("WARNING: Files created by this tool are designed to be detected as threats")
    print("         by ArcSentinel. They are NOT actual malware.\n")
    
    if args.type == "all":
        for malware_type in TEST_SIGNATURES.keys():
            create_test_file(malware_type, args.output)
    else:
        create_test_file(args.type, args.output)
    
    print("\nDone!")

if __name__ == "__main__":
    main()